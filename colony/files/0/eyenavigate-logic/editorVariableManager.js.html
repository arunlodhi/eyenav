<h1>editorVariableManager.js</h1>
<pre><code class="lang-js"><span class="comment">//This module uses the internal _codeMirror object, so it is fragile from future updates.</span>
define(<span class="function"><span class="keyword">function</span> <span class="params">(require, exports, module)</span> {</span>
  <span class="string">'use strict'</span>;

  <span class="keyword">var</span> EditorManager = brackets.getModule(<span class="string">'editor/EditorManager'</span>),
    TokenUtils = brackets.getModule(<span class="string">'utils/TokenUtils'</span>);

  <span class="keyword">var</span> _self = <span class="keyword">this</span>;

  <span class="comment">//Future: Figure out how to detect whether it is full screen or not</span>
  <span class="keyword">var</span> isFullScreen = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="literal">false</span>;
  };

  <span class="keyword">var</span> getCurrentEditorSizeAndCoords = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> curScreen = EditorManager.getCurrentFullEditor();
    <span class="keyword">var</span> cmDisplayObject = curScreen._codeMirror.display;

    <span class="keyword">var</span> editorHeight = cmDisplayObject.lastWrapHeight;
    <span class="keyword">var</span> editorWidth = cmDisplayObject.lineDiv.clientWidth;
    <span class="keyword">var</span> gutterWidth = cmDisplayObject.gutters.clientWidth;
    <span class="keyword">var</span> verticalScrollBarWidth = cmDisplayObject.barWidth;
    <span class="keyword">var</span> rightsideMenuWidth = <span class="number">30</span>;
    <span class="keyword">var</span> fileTreeBarWidth = window.innerWidth - gutterWidth - editorWidth - verticalScrollBarWidth - rightsideMenuWidth;

    <span class="keyword">var</span> topAppBarHeight = isFullScreen() ? <span class="number">0</span> : <span class="number">11</span>;
    <span class="comment">//Unnecessary, left for reference.</span>
    <span class="comment">//var bottomDescriptionBarHeight = 15;</span>

    <span class="keyword">var</span> coords = {};
    coords.x = window.screenX + fileTreeBarWidth + gutterWidth;
    coords.y = window.screenY + topAppBarHeight;
    coords.height = editorHeight;
    coords.width = editorWidth;

    <span class="keyword">return</span> coords;
  };

  <span class="keyword">var</span> getCharSize = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> curEditor = EditorManager.getCurrentFullEditor();
    <span class="keyword">var</span> charWidth = curEditor._codeMirror.display.cachedCharWidth || <span class="number">12</span>;
    <span class="keyword">var</span> rowHeight = curEditor._codeMirror.display.cachedTextHeight || <span class="number">25</span>;

    <span class="keyword">return</span> {
      width: charWidth,
      height: rowHeight
    };
  };

  <span class="keyword">var</span> getCursorCoords = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> curEditor = EditorManager.getCurrentFullEditor();
    <span class="keyword">var</span> cursorPos = curEditor.getCursorPos();
    <span class="keyword">var</span> charSize = getCharSize();

    <span class="keyword">var</span> cursorCoords = {
      x: cursorPos.ch * charSize.width,
      y: cursorPos.line * charSize.height
    };

    <span class="keyword">return</span> cursorCoords;
  };

  <span class="keyword">var</span> getNumOfLines = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> curEditor = EditorManager.getCurrentFullEditor();
    <span class="keyword">var</span> charSize = getCharSize();
    <span class="comment">//Future: Figure out where the 30 pixels come from (which variable)</span>
    <span class="keyword">var</span> scrollerHeight = curEditor._codeMirror.display.scroller.children[<span class="number">0</span>].clientHeight - <span class="number">30</span>;
    <span class="keyword">var</span> numOfLines = ~~(scrollerHeight / charSize.height);

    <span class="keyword">return</span> numOfLines;
  };

  <span class="keyword">var</span> getScreenMaxNumOfLines = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> editorCoordInfo = getCurrentEditorSizeAndCoords();
    <span class="keyword">var</span> charSize = getCharSize();

    <span class="keyword">var</span> visibleLines = ~~(editorCoordInfo.height / charSize.height);

    <span class="keyword">return</span> visibleLines;
  };

  <span class="keyword">var</span> getScrolledLines = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> curEditor = EditorManager.getCurrentFullEditor();
    <span class="keyword">var</span> scrollPos = curEditor.getScrollPos();
    <span class="keyword">var</span> charSize = getCharSize();
    <span class="keyword">var</span> scrolledLines = ~~(scrollPos.y / charSize.height);

    <span class="keyword">return</span> scrolledLines;
  };

  <span class="keyword">var</span> isGoalLineWithinBorders = <span class="function"><span class="keyword">function</span> <span class="params">(goalLine)</span> {</span>
    <span class="keyword">var</span> numOfLines = getNumOfLines();
    <span class="keyword">var</span> scrolledLines = getScrolledLines();
    <span class="keyword">var</span> maxLinesInScreen = getScreenMaxNumOfLines();

    <span class="keyword">if</span> (goalLine >= scrolledLines &amp;&amp; goalLine &lt; (scrolledLines + maxLinesInScreen)) {
      <span class="keyword">return</span> <span class="literal">true</span>;
    }

    <span class="keyword">return</span> <span class="literal">false</span>;
  };

  <span class="keyword">var</span> getToken = <span class="function"><span class="keyword">function</span> <span class="params">(cursorPos)</span> {</span>
    <span class="keyword">var</span> curEditor = EditorManager.getCurrentFullEditor();

    <span class="keyword">if</span> (cursorPos) {
      <span class="keyword">return</span> TokenUtils.getTokenAt(curEditor._codeMirror, cursorPos, <span class="literal">false</span>);

    } <span class="keyword">else</span> {
      <span class="keyword">return</span> TokenUtils.getTokenAt(curEditor._codeMirror, curEditor.getCursorPos(), <span class="literal">false</span>);
    }
  };

  exports.isFullScreen = isFullScreen;
  exports.getCurrentEditorSizeAndCoords = getCurrentEditorSizeAndCoords;
  exports.getCursorCoords = getCursorCoords;
  exports.getCharSize = getCharSize;
  exports.getNumOfLines = getNumOfLines;
  exports.getScreenMaxNumOfLines = getScreenMaxNumOfLines;
  exports.getScrolledLines = getScrolledLines;
  exports.isGoalLineWithinBorders = isGoalLineWithinBorders;
  exports.getToken = getToken;
});</code></pre>